<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=\, initial-scale=1.0">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
        <script src="jquery.emojiarea.js"></script>
        <link rel="stylesheet" href="test.css">
        <style>
            body{
                color : white;
                font-size: small;
            }
            #container{
                width: 50%;
                margin: 0 auto;
            }
            .messageBox2{
                width: 100%;
                height: 100%;
            }

            .chat-group{
                display:inline-block;
                width: 100%;
                align-items: center;
            }
            .nick-list{
                display:inline-block;
                width:20%;
            }
            .message{
                width:20%;
            }
            
            .chat-list {
                background-color: black;
                width: 100%;
                height: 80%;
                overflow: auto; /* í™”ë©´ë°–ìœ¼ë¡œ ê°ì²´ê°€ ë‚˜ê°€ ì§ˆ ë•Œ ì–´ë–¤ì‹ìœ¼ë¡œ ë°”ê¿€ì§€ */
                padding: 5%;
                box-sizing: border-box;
            }
            
            .chat-list div div {
                display:inline-block; 
                padding:5px;
            }

            .notice{
                display: block;
                text-align: center;
            }
            .my-chat {
                text-align: right;
            }

            .my-chat div{
                background-color: black;
                margin: 5px;
                border-width: 5px;
                border : solid rgb(133, 133, 133);
                border-radius: 2%;
                word-break: break-all; /* ì˜ì–´,ìˆ«ìê°€ í™”ë©´ë°–ìœ¼ë¡œ ë‚˜ê°ˆ ë•Œ ê¸€ìë¥¼ ì•„ë˜ë¡œ ë°”ê¿”ì£¼ëŠ” ê¸°ëŠ¥ */
            }

            .other-chat div {
                background-color: black;
                margin: 5px;
                border-width: 5px;
                border : solid rgb(133, 133, 133);
                border-radius: 2%;
                word-break: break-all;
            }

            input {
                width: 70%;
                height: 32px;
                font-size: 15px;
                border: 0;
                border-radius: 15px;
                outline: none;
                padding-left: 10px;
                background-color: rgb(233, 233, 233);
                margin : 10px;
            }               
            
            .emoji_container{
                width: 100%;
                padding: 2px;
            }
            .emoji_container button{
                margin: 0.5%;
            }
        </style>
    </head>

    <body>
        <div id="container">
            <div class="messageBox2">
                <div id="chat-list" class="chat-list"></div>
                <div class="chat-group">
                    <select id="nick-list">
                        <option value="ì „ì²´">ì „ì²´</option>
                    </select>
                    <input type="text" id="message" required >
                    <button type="button" onclick="send();" id= "sendBtn" >ì „ì†¡</button>
                    <div id="picker"></div>
                </div>
                <div class="emoji_container">
                    <button onclick="add('ğŸ˜ƒ')">ğŸ˜ƒ</button>
                    <button onclick="add('ğŸ˜„')">ğŸ˜„</button>
                    <button onclick="add('ğŸ¤£')">ğŸ¤£</button>
                    <button onclick="add('ğŸ˜€')">ğŸ˜€</button>
                    <button onclick="add('ğŸ˜')">ğŸ˜</button>
                    <button onclick="add('ğŸ˜‚')">ğŸ˜‚</button>
                    <button onclick="add('ğŸ˜†')">ğŸ˜†</button>
                    <button onclick="add('ğŸ˜‰')">ğŸ˜‰</button>
                    <button onclick="add('ğŸ˜‹')">ğŸ˜‹</button>
                    <button onclick="add('ğŸ˜Š')">ğŸ˜Š</button>
                    <button onclick="add('ğŸ˜')">ğŸ˜</button>
                    <button onclick="add('ğŸ˜')">ğŸ˜</button>
                    <button onclick="add('ğŸ˜˜')">ğŸ˜˜</button>
                    <button onclick="add('ğŸ˜—')">ğŸ˜—</button>
                    <button onclick="add('ğŸ˜”')">ğŸ˜”</button>
                    <button onclick="add('ğŸ™ƒ')">ğŸ™ƒ</button>
                    <button onclick="add('ğŸ˜•')">ğŸ˜•</button>
                    <button onclick="add('ğŸ˜¡')">ğŸ˜¡</button>
                    <button onclick="add('ğŸ¤‘')">ğŸ¤‘</button>
                    <button onclick="add('ğŸ¤¬')">ğŸ¤¬</button>
                    <button onclick="add('ğŸ¤¢')">ğŸ¤¢</button>
                    <button onclick="add('ğŸ˜‡')">ğŸ˜‡</button>
                    <button onclick="add('ğŸ¤­')">ğŸ¤­</button>
                    <button onclick="add('ğŸ˜²')">ğŸ˜²</button>
                    <button onclick="add('ğŸ¤¯')">ğŸ¤¯</button>
                    <button onclick="add('ğŸ˜­')">ğŸ˜­</button>
                    <button onclick="add('ğŸ™„')">ğŸ™„</button>
                    <button onclick="add('ğŸ˜')">ğŸ˜</button>
                    <button onclick="add('ğŸ˜´')">ğŸ˜´</button>
                    <button onclick="add('ğŸ¤')">ğŸ¤</button>
                    <button onclick="add('ğŸ˜¬')">ğŸ˜¬</button>
                    <button onclick="add('ğŸ’©')">ğŸ’©</button>
                    <button onclick="add('ğŸ¤–')">ğŸ¤–</button>
                    <button onclick="add('ğŸ‘½')">ğŸ‘½</button>
                </div>
            </div>
    </div>
        
        <script>
            var nickname = prompt("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            var socket = io.connect();
            socket.emit("info2", { nickname: nickname } );
            // socket.on("info", function(data){ id = data;});

            // var objDiv = document.getElementById("chat-list"); //ìŠ¤í¬ë¡¤ ì•„ë˜ë¡œ ë‚´ë¦¬ê¸° ì‹¤íŒ¨ 
            // objDiv.scrollTop = objDiv.scrollHeight; // ì‹¤íŒ¨ì´ìœ ëŠ” ë©”ì„¸ì§€ê°€ ë³´ë‚´ì¡Œì„ë•Œ ë˜ëŠ”ê±¸ë¡œ í•´ì•¼ë˜ëŠ”ë° ê·¸ëƒ¥í–ˆë‹¤.(ìœ„ì¹˜ì˜ëª»ê¸°ì¬)

                
            
            function send(){
                let msg = document.getElementById("message").value;
                if (msg == '') return; // ë©”ì„¸ì§€ê°’ì´ ì—†ì„ ë•Œ ì „ì†¡ë˜ì§€ ì•Šê²Œ í•˜ëŠ” ê¸°ëŠ¥
                let nick = document.getElementById("nick-list").value;
                // socket.emit("send", {id, msg});
                socket.emit("send", { msg : msg , to : nick});
                document.getElementById("message").value = "";
            }
            
            socket.on("newMessage", function(data){
                // data = { id: ~~~, msg: ~~~}
                let chat_list = document.getElementById("chat-list");
                let div = document.createElement("div");   // <div></div> /* ìì‹ìš”ì†Œë¡œ divíƒœê·¸ ì‚½ì…í•˜ê¸° */
                let div_chat = document.createElement("div"); // <div></div>
                var span = document.createElement("span");
                
                div_chat.textContent = data.msg; // <div>{msg}</div>
                
                if( data.is_dm ) div_chat.textContent = "(DM)" + div_chat.textContent;
                if( data.nickname == nickname ){ div.classList.add("my-chat");} 
                else {
                    span.textContent = data.nickname;
                    div.appendChild(span);
                    div.classList.add("other-chat");}

                // <div class = "my-chat"></div>

                // div => <div class="my-chat"></div>
                // div_chat => <div>{msg}</div>
                
                div.appendChild(div_chat);
                // <div class = "my-chat">
                    // <div>{msg}</div>
                // </div>
                
                chat_list.appendChild(div); /* appendChildëŠ” ë®ì–´ì“°ê¸°ê°€ ì•„ë‹ˆë¼ ë¶€ëª¨ ë…¸ë“œì— ìì‹ ë…¸ë“œë¥¼ ì¶”ê°€í•˜ëŠ” ë©”ì„œë“œ */
                chat_list.scrollTop = chat_list.scrollHeight //ìŠ¤í¬ë¡¤ ì•„ë˜ë¡œ ë‚´ë¦¬ê¸° ê³ ì •
            });
            
            socket.on("notice", function(data){
                let chat_list = document.getElementById("chat-list");
                let div = document.createElement("div");
                div.textContent = data;
                div.classList.add("notice")

                chat_list.appendChild(div);

            });
            socket.on("list", function(list){
                // list = { id ~~: nickname, id ~~: nickname };
                let nick_list = document.getElementById("nick-list");
                while (nick_list.firstChild){
                    nick_list.removeChild(nick_list.lastChild); //selectì•ˆì— ìì‹íƒœê·¸ê°€ ì—†ì„ë•Œê¹Œì§€ ì§€ìš´ë‹¤
                }; // ë‹¤ ì§€ìš´ í›„ì— ë‹¤ì‹œ ë®ì–´ì”Œìš°ê¸° ìœ„í•¨
                let option = document.createElement("option");
                option.text = "ì „ì²´";
                option.value = "ì „ì²´";
                nick_list.appendChild( option );

                var a = {
                    key1: '1',
                    key2: '2',
                    key3: '3',
                };
                for ( let [key,value] of Object.entries(a) ){
                    // key = "key1", value="1";
                    // key = "key2", value="2";
                }
                for ( let [key,value] of Object.entries(list)){
                    let option = document.createElement("option");
                    option.text = value;
                    option.value = value;
                    nick_list.appendChild( option );
                }
            });

            var input = document.getElementById('message');

            input.addEventListener("keyup", function (event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    document.getElementById("sendBtn").click();
                }
            });

            const add = c => document.querySelector('input').value+=c;
        </script>
    </body>
</html>